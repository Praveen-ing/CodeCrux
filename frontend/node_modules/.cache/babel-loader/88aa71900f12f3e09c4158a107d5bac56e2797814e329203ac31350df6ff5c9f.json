{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import Navbar from\"../../components/Navbar/Navbar\";// Assuming Navbar is still here per your code\nimport StreakCard from\"../../components/StreakCard/StreakCard\";import{fetchDailyChallengeAPI,markDailyChallengeSolvedAPI}from\"../../api/apiService\";import{useAuth}from\"../../context/AuthContext\";import{Loader2,AlertTriangle}from\"lucide-react\";import{motion}from\"framer-motion\";import\"./DailyChallenge.css\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const DailyChallengePage=()=>{const[dailyInfo,setDailyInfo]=useState({challenge:null,streak:0// Initial value\n});const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[isSubmitting,setIsSubmitting]=useState(false);const{userInfo,refreshUserProfile}=useAuth();const loadDailyData=async()=>{if(!userInfo){setError(\"Please log in to view the daily challenge.\");setLoading(false);setDailyInfo({challenge:null,streak:0});// Reset on logout\nreturn;}try{setLoading(true);setError(null);const response=await fetchDailyChallengeAPI();// This calls GET /api/daily-challenge\n// THE FIX IS HERE:\nsetDailyInfo({challenge:response.data.challenge,streak:response.data.currentStreak!==undefined?response.data.currentStreak:0// Use currentStreak\n});}catch(err){var _err$response,_err$response$data;console.error(\"Error fetching daily challenge in loadDailyData:\",err);setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||\"Failed to load daily challenge.\");// Optionally reset parts of dailyInfo on error, e.g.,\n// setDailyInfo(prev => ({ ...prev, challenge: null, streak: prev.streak })); // Keep streak if challenge fails to load\n}finally{setLoading(false);}};useEffect(()=>{loadDailyData();},[userInfo]);// Reload if user logs in/out\nconst handleSolve=async()=>{if(!dailyInfo.challenge||dailyInfo.challenge.completed)return;setIsSubmitting(true);setError(null);console.log(\"[DailyChallengePage] Starting handleSolve for challenge:\",dailyInfo.challenge.title);try{console.log(\"[DailyChallengePage] Calling markDailyChallengeSolvedAPI...\");const response=await markDailyChallengeSolvedAPI();// This calls POST /api/daily-challenge/solve\nconsole.log(\"[DailyChallengePage] markDailyChallengeSolvedAPI response:\",response.data);// This setDailyInfo is likely correct and sets streak to 1 from response.data.currentStreak\nsetDailyInfo(prevInfo=>({...prevInfo,challenge:response.data.dailyChallenge,// Ensure this key matches API response\nstreak:response.data.currentStreak!==undefined?response.data.currentStreak:0}));await refreshUserProfile();// This triggers the useEffect above, which calls loadDailyData again\n}catch(err){var _err$response2,_err$response2$data;console.error(\"Error marking challenge as solved:\",err);setError(((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.message)||\"Failed to mark as solved.\");}finally{setIsSubmitting(false);}};const pageVariants={initial:{opacity:0,scale:0.95},in:{opacity:1,scale:1},out:{opacity:0,scale:0.95}};return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(motion.div,{className:\"daily-challenge-page-main\",variants:pageVariants,initial:\"initial\",animate:\"in\",exit:\"out\",transition:{duration:0.4,ease:\"easeInOut\"},children:/*#__PURE__*/_jsxs(\"div\",{className:\"daily-challenge-container\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"page-title\",children:\"Daily Challenge\"}),loading&&/*#__PURE__*/_jsxs(\"div\",{className:\"loading-state\",children:[/*#__PURE__*/_jsx(Loader2,{size:48,className:\"spinner-icon\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading your challenge...\"})]}),error&&!loading&&/*#__PURE__*/_jsxs(\"div\",{className:\"error-message\",children:[/*#__PURE__*/_jsx(AlertTriangle,{size:32}),\" \",error]}),!loading&&!error&&userInfo&&dailyInfo.challenge&&/*#__PURE__*/_jsx(StreakCard,{streakCount:dailyInfo.streak,problem:dailyInfo.challenge,onSolve:handleSolve,isSolved:dailyInfo.challenge.completed,isLoading:isSubmitting}),!loading&&!error&&!userInfo&&/*#__PURE__*/_jsx(\"p\",{className:\"info-message\",children:\"Please log in to see your daily challenge.\"}),!loading&&!error&&userInfo&&!dailyInfo.challenge&&/*#__PURE__*/_jsx(\"p\",{className:\"info-message\",children:\"No daily challenge available at the moment. Try refreshing or check back later!\"})]})})});};export default DailyChallengePage;","map":{"version":3,"names":["React","useEffect","useState","Navbar","StreakCard","fetchDailyChallengeAPI","markDailyChallengeSolvedAPI","useAuth","Loader2","AlertTriangle","motion","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","DailyChallengePage","dailyInfo","setDailyInfo","challenge","streak","loading","setLoading","error","setError","isSubmitting","setIsSubmitting","userInfo","refreshUserProfile","loadDailyData","response","data","currentStreak","undefined","err","_err$response","_err$response$data","console","message","handleSolve","completed","log","title","prevInfo","dailyChallenge","_err$response2","_err$response2$data","pageVariants","initial","opacity","scale","in","out","children","div","className","variants","animate","exit","transition","duration","ease","size","streakCount","problem","onSolve","isSolved","isLoading"],"sources":["C:/Users/HP/OneDrive/Pictures/Documents/Desktop/CodeCrux/frontend/src/pages/DailyChallenge/DailyChallenge.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport Navbar from \"../../components/Navbar/Navbar\"; // Assuming Navbar is still here per your code\r\nimport StreakCard from \"../../components/StreakCard/StreakCard\";\r\nimport { fetchDailyChallengeAPI, markDailyChallengeSolvedAPI } from \"../../api/apiService\";\r\nimport { useAuth } from \"../../context/AuthContext\";\r\nimport { Loader2, AlertTriangle } from \"lucide-react\";\r\nimport { motion } from \"framer-motion\";\r\nimport \"./DailyChallenge.css\";\r\nconst DailyChallengePage = () => {\r\n  const [dailyInfo, setDailyInfo] = useState({\r\n    challenge: null,\r\n    streak: 0, // Initial value\r\n  });\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const { userInfo, refreshUserProfile } = useAuth();\r\n\r\n  const loadDailyData = async () => {\r\n    if (!userInfo) {\r\n      setError(\"Please log in to view the daily challenge.\");\r\n      setLoading(false);\r\n      setDailyInfo({ challenge: null, streak: 0 }); // Reset on logout\r\n      return;\r\n    }\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      const response = await fetchDailyChallengeAPI(); // This calls GET /api/daily-challenge\r\n      \r\n      // THE FIX IS HERE:\r\n      setDailyInfo({\r\n        challenge: response.data.challenge,\r\n        streak: response.data.currentStreak !== undefined ? response.data.currentStreak : 0, // Use currentStreak\r\n      });\r\n\r\n    } catch (err) {\r\n      console.error(\"Error fetching daily challenge in loadDailyData:\", err);\r\n      setError(err.response?.data?.message || \"Failed to load daily challenge.\");\r\n      // Optionally reset parts of dailyInfo on error, e.g.,\r\n      // setDailyInfo(prev => ({ ...prev, challenge: null, streak: prev.streak })); // Keep streak if challenge fails to load\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    loadDailyData();\r\n  }, [userInfo]); // Reload if user logs in/out\r\n\r\n  const handleSolve = async () => {\r\n    if (!dailyInfo.challenge || dailyInfo.challenge.completed) return;\r\n    setIsSubmitting(true);\r\n    setError(null);\r\n    console.log(\"[DailyChallengePage] Starting handleSolve for challenge:\", dailyInfo.challenge.title);\r\n\r\n    try {\r\n      console.log(\"[DailyChallengePage] Calling markDailyChallengeSolvedAPI...\");\r\n      const response = await markDailyChallengeSolvedAPI(); // This calls POST /api/daily-challenge/solve\r\n      console.log(\"[DailyChallengePage] markDailyChallengeSolvedAPI response:\", response.data);\r\n\r\n      // This setDailyInfo is likely correct and sets streak to 1 from response.data.currentStreak\r\n      setDailyInfo(prevInfo => ({\r\n        ...prevInfo,\r\n        challenge: response.data.dailyChallenge, // Ensure this key matches API response\r\n        streak: response.data.currentStreak !== undefined ? response.data.currentStreak : 0,\r\n      }));\r\n      \r\n      await refreshUserProfile(); // This triggers the useEffect above, which calls loadDailyData again\r\n    } catch (err) {\r\n      console.error(\"Error marking challenge as solved:\", err);\r\n      setError(err.response?.data?.message || \"Failed to mark as solved.\");\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n\r\n  const pageVariants = {\r\n    initial: { opacity: 0, scale: 0.95 },\r\n    in: { opacity: 1, scale: 1 },\r\n    out: { opacity: 0, scale: 0.95 },\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {/* If Navbar is part of App.jsx layout, remove it from here */}\r\n      {/* <Navbar />  */}\r\n      <motion.div\r\n        className=\"daily-challenge-page-main\"\r\n        variants={pageVariants}\r\n        initial=\"initial\"\r\n        animate=\"in\"\r\n        exit=\"out\"\r\n        transition={{ duration: 0.4, ease: \"easeInOut\" }}\r\n      >\r\n        <div className=\"daily-challenge-container\">\r\n          <h1 className=\"page-title\">Daily Challenge</h1>\r\n          {loading && (\r\n            <div className=\"loading-state\">\r\n              <Loader2 size={48} className=\"spinner-icon\" />\r\n              <p>Loading your challenge...</p>\r\n            </div>\r\n          )}\r\n          {error && !loading && (\r\n            <div className=\"error-message\">\r\n              <AlertTriangle size={32} /> {error}\r\n            </div>\r\n          )}\r\n          {!loading && !error && userInfo && dailyInfo.challenge && (\r\n            <StreakCard\r\n              streakCount={dailyInfo.streak}\r\n              problem={dailyInfo.challenge}\r\n              onSolve={handleSolve}\r\n              isSolved={dailyInfo.challenge.completed}\r\n              isLoading={isSubmitting}\r\n            />\r\n          )}\r\n          {!loading && !error && !userInfo && (\r\n            <p className=\"info-message\">Please log in to see your daily challenge.</p>\r\n          )}\r\n           {!loading && !error && userInfo && !dailyInfo.challenge && (\r\n            <p className=\"info-message\">No daily challenge available at the moment. Try refreshing or check back later!</p>\r\n          )}\r\n        </div>\r\n      </motion.div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default DailyChallengePage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}